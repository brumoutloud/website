<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events | Brum Out Loud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body class="antialiased">

    <header class="p-8">
        <nav class="container mx-auto flex justify-between items-center">
            <a href="/" class="font-anton text-2xl tracking-widest text-white">BRUM OUT LOUD</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="/events.html" class="nav-link active">EVENTS</a>
                <a href="/all-venues.html" class="nav-link">VENUES</a>
                <a href="/community.html" class="nav-link">COMMUNITY</a>
                <a href="/get-listed.html" class="nav-link">GET LISTED</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-8 py-16">
        <section class="max-w-6xl mx-auto">
            <div class="text-center mb-16">
                <h1 class="font-anton text-7xl md:text-8xl leading-none tracking-wider heading-gradient">UPCOMING <span class="accent-color">EVENTS</span></h1>
                <p class="mt-4 text-xl text-gray-300">What's on in Birmingham. Discover gigs, club nights, and more.</p>
            </div>
            
            <div class="mb-12">
                <input type="text" id="search-filter" placeholder="Filter by event name, venue, or genre..." class="w-full p-4 bg-gray-900/50 rounded-lg border border-gray-700 text-white placeholder-gray-500">
            </div>

            <div id="loading-state" class="text-center text-white">
                <p class="text-xl">Loading events...</p>
            </div>

            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>

            <div id="no-results-state" class="hidden text-center text-white">
                <p class="text-xl">No events match your filter.</p>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('events-grid');
            const searchInput = document.getElementById('search-filter');
            const loadingState = document.getElementById('loading-state');
            const noResultsState = document.getElementById('no-results-state');
            let allEvents = [];

            const createEventCard = (event) => `
                <a href="/.netlify/functions/get-event-details?id=${event.id}" class="card-bg block rounded-lg overflow-hidden group">
                    <img src="${event.imageUrl || 'https://placehold.co/600x400/1a202c/FFF?text=Brum+Out+Loud'}" alt="Promo image for ${event.name}" class="w-full h-48 object-cover group-hover:opacity-80 transition-opacity">
                    <div class="p-6">
                        <p class="text-sm font-semibold text-accent-color-secondary">${new Date(event.date).toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                        <h3 class="font-anton text-2xl text-white mt-2 leading-tight">${event.name}</h3>
                        <p class="text-gray-400 mt-2 flex items-center"><i class="fa-solid fa-location-dot fa-fw mr-2"></i> ${event.venueName}</p>
                    </div>
                </a>
            `;

            const renderEvents = (events) => {
                grid.innerHTML = events.map(createEventCard).join('');
                noResultsState.classList.toggle('hidden', events.length > 0);
            };

            fetch('/.netlify/functions/get-events')
                .then(response => response.json())
                .then(events => {
                    allEvents = events;
                    renderEvents(allEvents);
                    loadingState.classList.add('hidden');
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    loadingState.innerHTML = '<p class="text-red-500">Could not load events.</p>';
                });

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredEvents = allEvents.filter(event => 
                    event.name.toLowerCase().includes(searchTerm) ||
                    event.venueName.toLowerCase().includes(searchTerm) ||
                    (event.genre && event.genre.toLowerCase().includes(searchTerm))
                );
                renderEvents(filteredEvents);
            });
        });
    </script>
</body>
</html>
