<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body class="antialiased">
    <main class="container mx-auto px-8 py-16">
        <div id="event-list" class="space-y-4"></div>
        </main>

    <div id="edit-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
        <form id="edit-form" class="card-bg p-8 w-full max-w-3xl space-y-4 max-h-[90vh] overflow-y-auto">
             <h3 id="modal-title" class="font-anton text-3xl text-white">Edit Event</h3>
             <div id="edit-form-fields" class="space-y-4"></div>
             <div class="flex justify-end gap-4 pt-4">
                 <button type="button" id="cancel-edit-btn" class="btn-secondary">Cancel</button>
                 <button type="submit" class="btn-primary">Save Changes</button>
             </div>
        </form>
    </div>
    
    <script>
        // ... all existing DOM elements and state variables remain the same ...
        let allVenues = [];

        // (renderEvent function remains the same as your provided file)
        function renderEvent(item) { /* ... existing code ... */ }
        
        // (fetchVenues function is already in your file and is correct)
        async function fetchVenues() { /* ... existing code ... */ }

        function populateEditForm(item) {
            currentItemForAction = item;
            const isAdding = !item;
            const fields = isAdding ? {} : item.fields;
            // ... other existing variables ...

            // --- VENUE FIX START ---
            const venueOptionsHtml = allVenues.map(venue => {
                const isSelected = item && item.fields.Venue && item.fields.Venue[0] === venue.id;
                return `<option value="${venue.id}" ${isSelected ? 'selected' : ''}>${venue.name}</option>`;
            }).join('');

            const formHtml = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div><label>Event Name</label><input type="text" name="Event Name" value="${fields['Event Name'] || ''}" required></div>
                    <div><label>Parent Event Name</label><input type="text" name="Parent Event Name" value="${fields['Parent Event Name'] || ''}"></div>
                </div>
                <div>
                    <label>Venue</label>
                    <select name="venueId" class="venue-select w-full p-2 bg-gray-900/50 rounded-md border border-gray-700">
                        <option value="">-- Select a Venue --</option>
                        ${venueOptionsHtml}
                        <option value="__CREATE_NEW__">-- Add a new unlisted venue --</option>
                    </select>
                </div>
                <div class="hidden space-y-2" id="new-venue-fields">
                    <input type="text" id="new-venue-name" placeholder="New Venue Name" class="w-full p-2 bg-gray-800 rounded-md border border-gray-600">
                    <input type="text" id="new-venue-address" placeholder="New Venue Address" class="w-full p-2 bg-gray-800 rounded-md border border-gray-600">
                </div>
                `;
            // --- VENUE FIX END ---
            
            editFormFields.innerHTML = formHtml;
            // ... existing code to style new elements ...

            const venueSelect = editFormFields.querySelector('.venue-select');
            if (venueSelect) {
                // Pre-select the correct venue if the event is already linked
                if (item && item.fields.Venue && item.fields.Venue.length > 0) {
                    venueSelect.value = item.fields.Venue[0];
                }
                
                venueSelect.addEventListener('change', () => {
                    const newVenueFields = editFormFields.querySelector('#new-venue-fields');
                    if (venueSelect.value === '__CREATE_NEW__') {
                        newVenueFields.classList.remove('hidden');
                    } else {
                        newVenueFields.classList.add('hidden');
                    }
                });
            }
            editModal.classList.remove('hidden');
        }

        // --- All other event listeners and functions (DOMContentLoaded, fetchAndRenderEvents, etc.) remain the same ---
        // You would just need to integrate the new venue creation logic into the `editForm.addEventListener('submit', ...)` function,
        // exactly like the logic provided for the admin-approvals page above.
    </script>
</body>
</html>
