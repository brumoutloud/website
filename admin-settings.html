<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Settings | Brum Out Loud</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <script type="module" src="/js/auth-guard.js"></script>
</head>
<body class="antialiased">

    <header class="p-8">
        <nav class="container mx-auto flex justify-between items-center">
            <a href="/" class="font-anton text-2xl tracking-widest text-white">BRUM OUT LOUD</a>
            <div class="font-semibold text-gray-400">Admin Panel</div>
        </nav>
    </header>

    <main class="container mx-auto px-8 py-16">
        <section class="max-w-4xl mx-auto">
            <div class="text-center mb-16">
                <h1 class="font-anton text-7xl md:text-8xl leading-none tracking-wider heading-gradient">ADMIN <span class="accent-color">SETTINGS</span></h1>
                <p class="mt-4 text-xl text-gray-300 max-w-2xl mx-auto">Manage global settings and access content management tools.</p>
            </div>

            <div class="space-y-8">
                <!-- Affiliate Management Card -->
                <form id="settings-form" class="card-bg p-8 md:p-12 space-y-8">
                    <div>
                        <h2 class="font-anton text-3xl text-white mb-4 border-b border-gray-700 pb-2">Affiliate Link Management</h2>
                        <p class="text-gray-400 mb-6">The codes entered here will be automatically appended to the relevant links across the site.</p>
                        
                        <div class="space-y-6">
                            <div>
                                <label for="skiddle-id" class="block text-sm font-semibold mb-2 accent-color-secondary">Skiddle Affiliate ID (sktag)</label>
                                <input type="text" id="skiddle-id" name="skiddleId" placeholder="e.g., 15424" class="w-full p-3 bg-gray-900/50 rounded-lg border border-gray-700 focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none">
                            </div>
                            <div>
                                <label for="hotels-id" class="block text-sm font-semibold mb-2 accent-color-secondary">Hotels.com Affiliate ID</label>
                                <input type="text" id="hotels-id" name="hotelsId" placeholder="e.g., 12345" class="w-full p-3 bg-gray-900/50 rounded-lg border border-gray-700 focus:ring-2 focus:ring-accent-color focus:border-transparent outline-none">
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-right pt-4">
                        <button type="submit" class="bg-accent-color text-white font-bold py-3 px-8 rounded-lg hover:opacity-90 transition-opacity flex items-center">
                             <span id="save-button-text">Save Settings</span>
                             <span id="save-loader" class="loader ml-3 w-5 h-5 border-2 hidden"></span>
                        </button>
                    </div>
                    <div id="success-message" class="text-green-400 mt-4 text-center hidden">Settings saved successfully!</div>
                </form>

                <!-- Data Tools Card -->
                <div class="card-bg p-8 md:p-12">
                    <h2 class="font-anton text-3xl text-white mb-4 border-b border-gray-700 pb-2">Content Tools</h2>
                    <p class="text-gray-400 mb-6">Tools for managing submissions and site data.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- **FIX**: Added a span for the counter badge -->
                        <a href="/admin/approvals" class="nav-cta text-center flex items-center justify-center gap-2">
                            <span>Go to Approval Queue</span>
                            <span id="approval-count-badge" class="bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden">0</span>
                        </a>
                        <a href="/admin/poster-tool" class="nav-cta text-center">Go to Poster Parser</a>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <script>
        const form = document.getElementById('settings-form');
        const saveBtnText = document.getElementById('save-button-text');
        const saveLoader = document.getElementById('save-loader');
        const successMessage = document.getElementById('success-message');
        const approvalBadge = document.getElementById('approval-count-badge');

        function loadSettings() {
            document.getElementById('skiddle-id').value = '15424'; 
        }

        // **NEW**: Function to fetch and display the pending count
        async function loadPendingCount() {
            try {
                const response = await fetch('/.netlify/functions/get-pending-items');
                if (!response.ok) return;
                const items = await response.json();
                
                if (items.length > 0) {
                    approvalBadge.textContent = items.length;
                    approvalBadge.classList.remove('hidden');
                } else {
                    approvalBadge.classList.add('hidden');
                }
            } catch(error) {
                console.error("Could not fetch pending count:", error);
            }
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            saveBtnText.textContent = 'Saving...';
            saveLoader.classList.remove('hidden');
            successMessage.classList.add('hidden');
            form.querySelector('button[type=submit]').disabled = true;

            setTimeout(() => {
                saveBtnText.textContent = 'Save Settings';
                saveLoader.classList.add('hidden');
                form.querySelector('button[type=submit]').disabled = false;
                successMessage.classList.remove('hidden');
                setTimeout(() => {
                     successMessage.classList.add('hidden');
                }, 3000);

            }, 1500);
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadPendingCount(); // Fetch the count when the page loads
        });
    </script>
</body>
</html>
